{"ast":null,"code":"// noinspection JSBitwiseOperatorUsage\n\n'use strict';\n\nconst Capabilities = require('../../const/capabilities');\n\n/**\n * Initialize client capabilities according to options and server capabilities\n *\n * @param opts                options\n * @param info                information\n */\nmodule.exports.init = function (opts, info) {\n  let capabilities = Capabilities.IGNORE_SPACE | Capabilities.PROTOCOL_41 | Capabilities.TRANSACTIONS | Capabilities.SECURE_CONNECTION | Capabilities.MULTI_RESULTS | Capabilities.PS_MULTI_RESULTS | Capabilities.SESSION_TRACK | Capabilities.PLUGIN_AUTH_LENENC_CLIENT_DATA;\n  if (!(info.serverCapabilities & Capabilities.MYSQL)) {\n    capabilities |= Capabilities.MARIADB_CLIENT_EXTENDED_TYPE_INFO;\n  }\n  if (info.serverCapabilities & Capabilities.PLUGIN_AUTH) {\n    capabilities |= Capabilities.PLUGIN_AUTH;\n  }\n  if (opts.connectAttributes && info.serverCapabilities & Capabilities.CONNECT_ATTRS) {\n    capabilities |= Capabilities.CONNECT_ATTRS;\n  }\n  if (opts.foundRows) {\n    capabilities |= Capabilities.FOUND_ROWS;\n  }\n  if (opts.permitLocalInfile) {\n    capabilities |= Capabilities.LOCAL_FILES;\n  }\n  if (opts.multipleStatements) {\n    capabilities |= Capabilities.MULTI_STATEMENTS;\n  }\n  info.eofDeprecated = (info.serverCapabilities & Capabilities.DEPRECATE_EOF) > 0;\n  if (info.eofDeprecated) {\n    capabilities |= Capabilities.DEPRECATE_EOF;\n  }\n  if (opts.database && info.serverCapabilities & Capabilities.CONNECT_WITH_DB) {\n    capabilities |= Capabilities.CONNECT_WITH_DB;\n  }\n  info.serverPermitSkipMeta = (info.serverCapabilities & Capabilities.MARIADB_CLIENT_CACHE_METADATA) > 0;\n  if (info.serverPermitSkipMeta) {\n    capabilities |= Capabilities.MARIADB_CLIENT_CACHE_METADATA;\n  }\n\n  // use compression only if requested by client and supported by server\n  if (opts.compress) {\n    if (info.serverCapabilities & Capabilities.COMPRESS) {\n      capabilities |= Capabilities.COMPRESS;\n    } else {\n      opts.compress = false;\n    }\n  }\n  if (opts.bulk) {\n    if (info.serverCapabilities & Capabilities.MARIADB_CLIENT_STMT_BULK_OPERATIONS) {\n      capabilities |= Capabilities.MARIADB_CLIENT_STMT_BULK_OPERATIONS;\n    }\n  }\n  if (opts.permitConnectionWhenExpired) {\n    capabilities |= Capabilities.CAN_HANDLE_EXPIRED_PASSWORDS;\n  }\n  info.clientCapabilities = capabilities;\n};","map":{"version":3,"names":["Capabilities","require","module","exports","init","opts","info","capabilities","IGNORE_SPACE","PROTOCOL_41","TRANSACTIONS","SECURE_CONNECTION","MULTI_RESULTS","PS_MULTI_RESULTS","SESSION_TRACK","PLUGIN_AUTH_LENENC_CLIENT_DATA","serverCapabilities","MYSQL","MARIADB_CLIENT_EXTENDED_TYPE_INFO","PLUGIN_AUTH","connectAttributes","CONNECT_ATTRS","foundRows","FOUND_ROWS","permitLocalInfile","LOCAL_FILES","multipleStatements","MULTI_STATEMENTS","eofDeprecated","DEPRECATE_EOF","database","CONNECT_WITH_DB","serverPermitSkipMeta","MARIADB_CLIENT_CACHE_METADATA","compress","COMPRESS","bulk","MARIADB_CLIENT_STMT_BULK_OPERATIONS","permitConnectionWhenExpired","CAN_HANDLE_EXPIRED_PASSWORDS","clientCapabilities"],"sources":["/home/warameur/Documents/velocity-data-viz/node_modules/mariadb/lib/cmd/handshake/client-capabilities.js"],"sourcesContent":["// noinspection JSBitwiseOperatorUsage\n\n'use strict';\n\nconst Capabilities = require('../../const/capabilities');\n\n/**\n * Initialize client capabilities according to options and server capabilities\n *\n * @param opts                options\n * @param info                information\n */\nmodule.exports.init = function (opts, info) {\n  let capabilities =\n    Capabilities.IGNORE_SPACE |\n    Capabilities.PROTOCOL_41 |\n    Capabilities.TRANSACTIONS |\n    Capabilities.SECURE_CONNECTION |\n    Capabilities.MULTI_RESULTS |\n    Capabilities.PS_MULTI_RESULTS |\n    Capabilities.SESSION_TRACK |\n    Capabilities.PLUGIN_AUTH_LENENC_CLIENT_DATA;\n\n  if (!(info.serverCapabilities & Capabilities.MYSQL)) {\n    capabilities |= Capabilities.MARIADB_CLIENT_EXTENDED_TYPE_INFO;\n  }\n\n  if (info.serverCapabilities & Capabilities.PLUGIN_AUTH) {\n    capabilities |= Capabilities.PLUGIN_AUTH;\n  }\n\n  if (opts.connectAttributes && info.serverCapabilities & Capabilities.CONNECT_ATTRS) {\n    capabilities |= Capabilities.CONNECT_ATTRS;\n  }\n\n  if (opts.foundRows) {\n    capabilities |= Capabilities.FOUND_ROWS;\n  }\n\n  if (opts.permitLocalInfile) {\n    capabilities |= Capabilities.LOCAL_FILES;\n  }\n\n  if (opts.multipleStatements) {\n    capabilities |= Capabilities.MULTI_STATEMENTS;\n  }\n\n  info.eofDeprecated = (info.serverCapabilities & Capabilities.DEPRECATE_EOF) > 0;\n  if (info.eofDeprecated) {\n    capabilities |= Capabilities.DEPRECATE_EOF;\n  }\n\n  if (opts.database && info.serverCapabilities & Capabilities.CONNECT_WITH_DB) {\n    capabilities |= Capabilities.CONNECT_WITH_DB;\n  }\n\n  info.serverPermitSkipMeta = (info.serverCapabilities & Capabilities.MARIADB_CLIENT_CACHE_METADATA) > 0;\n  if (info.serverPermitSkipMeta) {\n    capabilities |= Capabilities.MARIADB_CLIENT_CACHE_METADATA;\n  }\n\n  // use compression only if requested by client and supported by server\n  if (opts.compress) {\n    if (info.serverCapabilities & Capabilities.COMPRESS) {\n      capabilities |= Capabilities.COMPRESS;\n    } else {\n      opts.compress = false;\n    }\n  }\n\n  if (opts.bulk) {\n    if (info.serverCapabilities & Capabilities.MARIADB_CLIENT_STMT_BULK_OPERATIONS) {\n      capabilities |= Capabilities.MARIADB_CLIENT_STMT_BULK_OPERATIONS;\n    }\n  }\n\n  if (opts.permitConnectionWhenExpired) {\n    capabilities |= Capabilities.CAN_HANDLE_EXPIRED_PASSWORDS;\n  }\n  info.clientCapabilities = capabilities;\n};\n"],"mappings":"AAAA;;AAEA,YAAY;;AAEZ,MAAMA,YAAY,GAAGC,OAAO,CAAC,0BAA0B,CAAC;;AAExD;AACA;AACA;AACA;AACA;AACA;AACAC,MAAM,CAACC,OAAO,CAACC,IAAI,GAAG,UAAUC,IAAI,EAAEC,IAAI,EAAE;EAC1C,IAAIC,YAAY,GACdP,YAAY,CAACQ,YAAY,GACzBR,YAAY,CAACS,WAAW,GACxBT,YAAY,CAACU,YAAY,GACzBV,YAAY,CAACW,iBAAiB,GAC9BX,YAAY,CAACY,aAAa,GAC1BZ,YAAY,CAACa,gBAAgB,GAC7Bb,YAAY,CAACc,aAAa,GAC1Bd,YAAY,CAACe,8BAA8B;EAE7C,IAAI,EAAET,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAACiB,KAAK,CAAC,EAAE;IACnDV,YAAY,IAAIP,YAAY,CAACkB,iCAAiC;EAChE;EAEA,IAAIZ,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAACmB,WAAW,EAAE;IACtDZ,YAAY,IAAIP,YAAY,CAACmB,WAAW;EAC1C;EAEA,IAAId,IAAI,CAACe,iBAAiB,IAAId,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAACqB,aAAa,EAAE;IAClFd,YAAY,IAAIP,YAAY,CAACqB,aAAa;EAC5C;EAEA,IAAIhB,IAAI,CAACiB,SAAS,EAAE;IAClBf,YAAY,IAAIP,YAAY,CAACuB,UAAU;EACzC;EAEA,IAAIlB,IAAI,CAACmB,iBAAiB,EAAE;IAC1BjB,YAAY,IAAIP,YAAY,CAACyB,WAAW;EAC1C;EAEA,IAAIpB,IAAI,CAACqB,kBAAkB,EAAE;IAC3BnB,YAAY,IAAIP,YAAY,CAAC2B,gBAAgB;EAC/C;EAEArB,IAAI,CAACsB,aAAa,GAAG,CAACtB,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAAC6B,aAAa,IAAI,CAAC;EAC/E,IAAIvB,IAAI,CAACsB,aAAa,EAAE;IACtBrB,YAAY,IAAIP,YAAY,CAAC6B,aAAa;EAC5C;EAEA,IAAIxB,IAAI,CAACyB,QAAQ,IAAIxB,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAAC+B,eAAe,EAAE;IAC3ExB,YAAY,IAAIP,YAAY,CAAC+B,eAAe;EAC9C;EAEAzB,IAAI,CAAC0B,oBAAoB,GAAG,CAAC1B,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAACiC,6BAA6B,IAAI,CAAC;EACtG,IAAI3B,IAAI,CAAC0B,oBAAoB,EAAE;IAC7BzB,YAAY,IAAIP,YAAY,CAACiC,6BAA6B;EAC5D;;EAEA;EACA,IAAI5B,IAAI,CAAC6B,QAAQ,EAAE;IACjB,IAAI5B,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAACmC,QAAQ,EAAE;MACnD5B,YAAY,IAAIP,YAAY,CAACmC,QAAQ;IACvC,CAAC,MAAM;MACL9B,IAAI,CAAC6B,QAAQ,GAAG,KAAK;IACvB;EACF;EAEA,IAAI7B,IAAI,CAAC+B,IAAI,EAAE;IACb,IAAI9B,IAAI,CAACU,kBAAkB,GAAGhB,YAAY,CAACqC,mCAAmC,EAAE;MAC9E9B,YAAY,IAAIP,YAAY,CAACqC,mCAAmC;IAClE;EACF;EAEA,IAAIhC,IAAI,CAACiC,2BAA2B,EAAE;IACpC/B,YAAY,IAAIP,YAAY,CAACuC,4BAA4B;EAC3D;EACAjC,IAAI,CAACkC,kBAAkB,GAAGjC,YAAY;AACxC,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}