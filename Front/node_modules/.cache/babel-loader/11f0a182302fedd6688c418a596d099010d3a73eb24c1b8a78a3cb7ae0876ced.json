{"ast":null,"code":"'use strict';\n\nconst PluginAuth = require('./plugin-auth');\nconst Crypto = require('crypto');\n\n/**\n * Standard authentication plugin\n */\nclass NativePasswordAuth extends PluginAuth {\n  constructor(packSeq, compressPackSeq, pluginData, cmdParam, resolve, reject, multiAuthResolver) {\n    super(cmdParam, resolve, reject, multiAuthResolver);\n    this.pluginData = pluginData;\n    this.sequenceNo = packSeq;\n    this.compressSequenceNo = compressPackSeq;\n  }\n  start(out, opts, info) {\n    //seed is ended with a null byte value.\n    const data = this.pluginData.slice(0, 20);\n    let authToken = NativePasswordAuth.encryptSha1Password(opts.password, data);\n    out.startPacket(this);\n    if (authToken.length > 0) {\n      out.writeBuffer(authToken, 0, authToken.length);\n      out.flushPacket();\n    } else {\n      out.writeEmptyPacket(true);\n    }\n    this.emit('send_end');\n    this.onPacketReceive = this.successSend;\n  }\n  static encryptSha1Password(password, seed) {\n    if (!password) return Buffer.alloc(0);\n    let hash = Crypto.createHash('sha1');\n    let stage1 = hash.update(password, 'utf8').digest();\n    hash = Crypto.createHash('sha1');\n    let stage2 = hash.update(stage1).digest();\n    hash = Crypto.createHash('sha1');\n    hash.update(seed);\n    hash.update(stage2);\n    let digest = hash.digest();\n    let returnBytes = Buffer.allocUnsafe(digest.length);\n    for (let i = 0; i < digest.length; i++) {\n      returnBytes[i] = stage1[i] ^ digest[i];\n    }\n    return returnBytes;\n  }\n}\nmodule.exports = NativePasswordAuth;","map":{"version":3,"names":["PluginAuth","require","Crypto","NativePasswordAuth","constructor","packSeq","compressPackSeq","pluginData","cmdParam","resolve","reject","multiAuthResolver","sequenceNo","compressSequenceNo","start","out","opts","info","data","slice","authToken","encryptSha1Password","password","startPacket","length","writeBuffer","flushPacket","writeEmptyPacket","emit","onPacketReceive","successSend","seed","Buffer","alloc","hash","createHash","stage1","update","digest","stage2","returnBytes","allocUnsafe","i","module","exports"],"sources":["/home/warameur/Documents/velocity-data-viz/node_modules/mariadb/lib/cmd/handshake/auth/native-password-auth.js"],"sourcesContent":["'use strict';\n\nconst PluginAuth = require('./plugin-auth');\nconst Crypto = require('crypto');\n\n/**\n * Standard authentication plugin\n */\nclass NativePasswordAuth extends PluginAuth {\n  constructor(packSeq, compressPackSeq, pluginData, cmdParam, resolve, reject, multiAuthResolver) {\n    super(cmdParam, resolve, reject, multiAuthResolver);\n    this.pluginData = pluginData;\n    this.sequenceNo = packSeq;\n    this.compressSequenceNo = compressPackSeq;\n  }\n\n  start(out, opts, info) {\n    //seed is ended with a null byte value.\n    const data = this.pluginData.slice(0, 20);\n    let authToken = NativePasswordAuth.encryptSha1Password(opts.password, data);\n\n    out.startPacket(this);\n    if (authToken.length > 0) {\n      out.writeBuffer(authToken, 0, authToken.length);\n      out.flushPacket();\n    } else {\n      out.writeEmptyPacket(true);\n    }\n    this.emit('send_end');\n    this.onPacketReceive = this.successSend;\n  }\n\n  static encryptSha1Password(password, seed) {\n    if (!password) return Buffer.alloc(0);\n\n    let hash = Crypto.createHash('sha1');\n    let stage1 = hash.update(password, 'utf8').digest();\n    hash = Crypto.createHash('sha1');\n\n    let stage2 = hash.update(stage1).digest();\n    hash = Crypto.createHash('sha1');\n\n    hash.update(seed);\n    hash.update(stage2);\n\n    let digest = hash.digest();\n    let returnBytes = Buffer.allocUnsafe(digest.length);\n    for (let i = 0; i < digest.length; i++) {\n      returnBytes[i] = stage1[i] ^ digest[i];\n    }\n    return returnBytes;\n  }\n}\n\nmodule.exports = NativePasswordAuth;\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,UAAU,GAAGC,OAAO,CAAC,eAAe,CAAC;AAC3C,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAQ,CAAC;;AAEhC;AACA;AACA;AACA,MAAME,kBAAkB,SAASH,UAAU,CAAC;EAC1CI,WAAWA,CAACC,OAAO,EAAEC,eAAe,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,OAAO,EAAEC,MAAM,EAAEC,iBAAiB,EAAE;IAC9F,KAAK,CAACH,QAAQ,EAAEC,OAAO,EAAEC,MAAM,EAAEC,iBAAiB,CAAC;IACnD,IAAI,CAACJ,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACK,UAAU,GAAGP,OAAO;IACzB,IAAI,CAACQ,kBAAkB,GAAGP,eAAe;EAC3C;EAEAQ,KAAKA,CAACC,GAAG,EAAEC,IAAI,EAAEC,IAAI,EAAE;IACrB;IACA,MAAMC,IAAI,GAAG,IAAI,CAACX,UAAU,CAACY,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;IACzC,IAAIC,SAAS,GAAGjB,kBAAkB,CAACkB,mBAAmB,CAACL,IAAI,CAACM,QAAQ,EAAEJ,IAAI,CAAC;IAE3EH,GAAG,CAACQ,WAAW,CAAC,IAAI,CAAC;IACrB,IAAIH,SAAS,CAACI,MAAM,GAAG,CAAC,EAAE;MACxBT,GAAG,CAACU,WAAW,CAACL,SAAS,EAAE,CAAC,EAAEA,SAAS,CAACI,MAAM,CAAC;MAC/CT,GAAG,CAACW,WAAW,EAAE;IACnB,CAAC,MAAM;MACLX,GAAG,CAACY,gBAAgB,CAAC,IAAI,CAAC;IAC5B;IACA,IAAI,CAACC,IAAI,CAAC,UAAU,CAAC;IACrB,IAAI,CAACC,eAAe,GAAG,IAAI,CAACC,WAAW;EACzC;EAEA,OAAOT,mBAAmBA,CAACC,QAAQ,EAAES,IAAI,EAAE;IACzC,IAAI,CAACT,QAAQ,EAAE,OAAOU,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;IAErC,IAAIC,IAAI,GAAGhC,MAAM,CAACiC,UAAU,CAAC,MAAM,CAAC;IACpC,IAAIC,MAAM,GAAGF,IAAI,CAACG,MAAM,CAACf,QAAQ,EAAE,MAAM,CAAC,CAACgB,MAAM,EAAE;IACnDJ,IAAI,GAAGhC,MAAM,CAACiC,UAAU,CAAC,MAAM,CAAC;IAEhC,IAAII,MAAM,GAAGL,IAAI,CAACG,MAAM,CAACD,MAAM,CAAC,CAACE,MAAM,EAAE;IACzCJ,IAAI,GAAGhC,MAAM,CAACiC,UAAU,CAAC,MAAM,CAAC;IAEhCD,IAAI,CAACG,MAAM,CAACN,IAAI,CAAC;IACjBG,IAAI,CAACG,MAAM,CAACE,MAAM,CAAC;IAEnB,IAAID,MAAM,GAAGJ,IAAI,CAACI,MAAM,EAAE;IAC1B,IAAIE,WAAW,GAAGR,MAAM,CAACS,WAAW,CAACH,MAAM,CAACd,MAAM,CAAC;IACnD,KAAK,IAAIkB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,MAAM,CAACd,MAAM,EAAEkB,CAAC,EAAE,EAAE;MACtCF,WAAW,CAACE,CAAC,CAAC,GAAGN,MAAM,CAACM,CAAC,CAAC,GAAGJ,MAAM,CAACI,CAAC,CAAC;IACxC;IACA,OAAOF,WAAW;EACpB;AACF;AAEAG,MAAM,CAACC,OAAO,GAAGzC,kBAAkB"},"metadata":{},"sourceType":"script","externalDependencies":[]}